# SQL Server Service

This exercise is designed to mount a volume to persist data from a Docker service in local host with [the azure sql edge](https://hub.docker.com/r/microsoft/azure-sql-edge) image. 

## Subject

As we have already seen (twice), docker provides a way to create isolated environments that can be used to run services the same way on different machines.

On Docker Hub, you can find an infinity of images that can be used to run services.
Azure sql edge is one of them and a cloud-based relational database service.

When using Containers, you have to keep in mind that the data is not persisted by default.
To do so, you can use volumes or mount directories from the host as volume.

Volumes are stored in a part of the host filesystem which is managed by Docker and accessible only from within Docker.

To create a volume, you can use the `docker volume create <volume name>` command.
This will create your volume in the Docker environment.
To verify that the volume has been created, you can use the `docker volume ls` command.

To mount a directory from the host, you can use the `-v` option in the `docker run` command.

## Exercise

Pull and run the Azure sql edge image twice as a background service.

- The first service should persist data in a docker volume and run service on port 1433.
- The second service should persist data in a mounted directory from the host and run service on port 1434.

Inspired from the [docker run doc.](https://docs.docker.com/reference/cli/docker/container/run/), the [azure sql edge image doc.](https://hub.docker.com/r/microsoft/azure-sql-edge) and the [starter-kit](../000-starter-kit/README.md) if needed.

<details>
  <summary>Solution</summary>

### With a volume

```shell
docker volume create sqlsrv-data
docker run -d -p 1433:1433 --name sqlsrv -v sqlsrv-data:/var/opt/mssql mcr.microsoft.com/azure-sql-edge
```

The command docker volume create sqlsrv-data is used to create a Docker volume named sqlsrv-data.
- `docker volume create`: This is the Docker command to create a new volume.
- `sqlsrv-data`: This is the name of the volume being created.

```shell
docker run -d -p 1433:1433 --name sqlsrv -v sqlsrv-data:/var/opt/mssql mcr.microsoft.com/azure-sql-edge
```

The command is used to run a Docker container with the Azure SQL Edge image. Here is a breakdown of the command:
- `docker run`: This is the Docker command to run a new container.
- `-d`: Runs the container in detached mode (in the background).
- `-p 1433:1433`: Maps port 1433 of the container to port 1433 of the host. This allows applications on the host to access the SQL Server in the container using port 1433.
- `--name sqlsrv`: Assigns the name "sqlsrv" to the container for easier identification.
- `-v sqlsrv-data`:/var/opt/mssql: Mounts the Docker volume sqlsrv-data to the /var/opt/mssql directory inside the container. This is used to persist data generated by the SQL Server.
- `mcr.microsoft.com/azure-sql-edge`: Specifies the Docker image to use for the container, which is the Azure SQL Edge image from Microsoft's container registry.

### With a mounted directory from host

```shell
docker run -d -p 1434:1433 --name sqlsrv -v /path/to/host/directory:/var/opt/mssql -e 'ACCEPT_EULA=1' -e 'MSSQL_SA_PASSWORD=yourStrong(!)Password' mcr.microsoft.com/azure-sql-edge
```

The command is used to run a Docker container with the Azure SQL Edge image, persisting data in a mounted directory from the host. Here is a breakdown of the command:
- `docker run`: This is the Docker command to run a new container.
- `-d`: Runs the container in detached mode (in the background).
- `-p 1434:1433`: Maps port 1433 of the container to port 1434 of the host. This allows applications on the host to access the SQL Server in the container using port 1434.
- `--name sqlsrv`: Assigns the name "sqlsrv" to the container for easier identification.
- `-v /path/to/host/directory:/var/opt/mssql`: Mounts the host directory `/path/to/host/directory` to the `/var/opt/mssql` directory inside the container. This is used to persist data generated by the SQL Server.
- `-e 'ACCEPT_EULA=1'`: Sets the environment variable `ACCEPT_EULA` to 1, which is required to accept the end-user license agreement.
- `-e 'MSSQL_SA_PASSWORD=yourStrong(!)Password'`: Sets the environment variable `MSSQL_SA_PASSWORD` to `yourStrong(!)Password`, which is required to set the SA (system administrator) password for the SQL Server.
- `mcr.microsoft.com/azure-sql-edge`: Specifies the Docker image to use for the container, which is the Azure SQL Edge image from Microsoft's container registry.
</details>
